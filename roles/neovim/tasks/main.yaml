---
- name: NeoVim Ubuntu PPA is present
  become: true
  ansible.builtin.apt_repository:
    repo: ppa:neovim-ppa/stable

- name: Latest NeoVim is installed
  become: true
  ansible.builtin.apt:
    name: neovim
    state: latest
    update_cache: yes

- name: packer.nvim repository is cloned
  ansible.builtin.git:
    repo: https://github.com/wbthomason/packer.nvim.git
    dest: ~/.local/share/nvim/site/pack/packer/start/packer.nvim

- name: NeoVim config is present
  ansible.builtin.template:
    src: init.vim
    dest: ~/.config/nvim/init.vim
    backup: yes
    mode: u=rw,go=r

- name: Lua folder is present
  ansible.builtin.file:
    path: ~/.config/nvim/lua
    state: directory

- name: plugins.lua is present
  ansible.builtin.template:
    src: plugins.lua
    dest: ~/.config/nvim/lua/plugins.lua
    backup: yes
    mode: u=rw,go=r

- name: TypeScript language server is installed
  community.general.npm:
    name: typescript-language-server
    global: true
    state: latest

- name: YAML language server is installed
  community.general.npm:
    name: yaml-language-server
    global: true
    state: latest

- name: Dockerfile language server is installed
  community.general.npm:
    name: dockerfile-language-server-nodejs
    global: true
    state: latest

- name: Python language server is installed
  ansible.builtin.pip:
    name: pyright
    state: latest

- name: search tools are installed
  become: true
  ansible.builtin.apt:
    name:
      - ripgrep
      - fd-find
    state: latest

- name: Sync Packer dependencies
  ansible.builtin.command: nvim --headless +PackerSync +q

